:80 {
	encode gzip

	# CORS headers for browser-based API access
	header {
		Access-Control-Allow-Origin "*"
		Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
		Access-Control-Allow-Headers "Content-Type, X-Debug-Subject, Authorization"
	}

	# Handle preflight OPTIONS requests
	@options {
		method OPTIONS
	}
	handle @options {
		respond 204
	}

	# Proxy to the API container.
	reverse_proxy api:8080 {
		header_up X-Forwarded-Proto {scheme}
		header_up X-Forwarded-Host {host}
		header_up X-Forwarded-For {remote_host}
	}

	# Optional proxy-level health endpoint
	respond /proxy-healthz 200
}